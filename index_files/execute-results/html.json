{
  "hash": "9c90e6d47ed83a910dfa6e3a3a7da053",
  "result": {
    "markdown": "---\n# Metadatos ----------------------\ntitle: \"Analysis of summer 2022 wildfires blast in Folgoso do Courel, Spain\"\ndate: today\nauthor: 'Adrián Cidre González'\n\nabstract: \"Galicia is the northestern region of Spain. Its climate has critical features that make it a particular scenario for wildfires. The very humid conditions of the region combined with the rural Exodus created a continuous forest structure dominated by very flammable species such as *Erica* spp., *Cytisus scoparius*, etc. Conversely to what is expected from a humid region, Galicia gathers almost half of the wildfires (in area and number) of Spain. This is explained by the fact that summer is Mediterranean-influenced, and severe droughts can be expected in Galicia, specially in the province of Ourense. The wildfires of summer 2022 will be in the memory of the Galician population, when more than 40,000 ha burned during more than 1 month during July and August. A total of 63 of large forest fires (i.e. greater than 500 ha) were registed in Galicia until the $31^{st}$ of August. Furthermore, the two greatest wildfires of the history of Galicia since we have registers were recorded. One comprises the municipality of Folgoso do Courel, where about 6,400 hectares burned of which the 89% presented moderate to high levels of severity. The spatio-temporal dynamics showed that the northern area (higher in altitude) was typically healthier and humid, resulting in absence of fires, whereas the southern area with unhealthier and less humid vegetation was devastated.\"\n\n# Format options --------------------\npage-layout: full\n\n# Code -----------------------------\ncode-copy: hover\nexecute: \n  warning: false\n\n# References ----------------------\ncrossref: \n  fig-title: \"Fig.\"\n  fig-prefix: \"Fig.\"\n\n# Figures and tables --------------\nfig-align: 'center'\nfig-cap-location: bottom\ntbl-cap-location: top\n---\n\n\n## Introduction {#sec-intro}\n\nDuring the summer of 2022, the region of Galicia was devastated by wildfires, with over 40,000 hectares burned in just July and August. The fire outbreak began with an intense dry storm on the evening of July $15^{th}$, which brought with it over 6,000 lightning strikes in less than 4 hours. The same week, temperatures in Ourense reached a record high of 44ºC, with similar heat waves reported throughout the province. These extreme weather conditions created the perfect storm for the spread of devastating wildfires.\n\nThe year 2022 was marked by a severe drought, which affected not only the summer months but also late winter and spring, a crucial time for replenishing the trees' water supply. This shortage of water caused significant stress to the vegetation, which was further exacerbated by the ongoing rural abandonment. With no human intervention, dead biomass accumulated in large quantities, creating dangerous conditions for wildfires. The unusual weather conditions combined with the high amount of fuel available led to an unprecedented number of wildfires, which overwhelmed the firefighting resources and were difficult to contain. The existing firefighting infrastructure was not equipped to handle such a catastrophic situation.\n\nIn this study, I studied how the vegetation stress evolved over time. To relate it, a comparison was made of a relatively normal (average precipitation) year as it was 2021 with 954 registered wildfires and only 4,400 ha burned, against a dry year as 2022 with more than 40,000 ha burned in only 2 months (July and August).\n\nThe aim of this work was to study the spatio-temporal dynamics using vegetation indices derived from remote sensing images. The specific objectives were: (1) to study spatio-temporal dynamics of vegetation statues using the well-known Enhanced Vegetation Index (EVI); (2) to study the spatio-temporal dynamics of vegetation moisture through the Normalized Difference Water Index (NDWI); (3) to define the burned area and its severity.\n\n<br>\n\n## Materials and Methods {#sec-matmet}\n\n### Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(pacman)\n\np_load(sf, here, terra, geodata, tidyverse, ggspatial, mapview, elevatr,\n       rasterVis, tidyterra, cptcity, RColorBrewer, spatialEco, report,\n       lubridate, RStoolbox, flextable, leafpop)\n```\n:::\n\n\n<br>\n\n### Study area {#sec-aoi}\n\nThe selected study area is the subregion of Folgoso de Courel (Galicia) which was severely affected by wildfires.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download spanish level 4 boundaries\nspain <- gadm(country = 'ESP',\n              level = 4,\n              path = here('inputs/'),\n              resolution = 2)\n\n# Filter study area\naoi <- spain |> \n  st_as_sf() |> \n  filter(NAME_4 == 'Folgoso do Courel')\n```\n:::\n\n\nIn @fig-aoi we can see the location of the study area. Setting on the *Esri.WorldImagery* map, we can see that the region is very montanious, and mostly covered by forests.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nmapview(aoi,\n        viewer.suppress = mapviewGetOption(\"viewer.suppress\"),\n        color = 'red',\n        lwd = 3,\n        alpha.regions = 0,\n        label = 'Folgoso do Courel',\n        legend = FALSE\n        )\n```\n\n::: {#fig-aoi .cell-output-display}\n```{=html}\n<div class=\"leaflet html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-95d72ec909fe949e70ad\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-95d72ec909fe949e70ad\">{\"x\":{\"options\":{\"minZoom\":1,\"maxZoom\":52,\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}},\"preferCanvas\":false,\"bounceAtZoomLimits\":false,\"maxBounds\":[[[-90,-370]],[[90,370]]]},\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",\"CartoDB.Positron\",\"CartoDB.Positron\",{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false,\"pane\":\"tilePane\"}]},{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.DarkMatter\",\"CartoDB.DarkMatter\",\"CartoDB.DarkMatter\",{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false,\"pane\":\"tilePane\"}]},{\"method\":\"addProviderTiles\",\"args\":[\"OpenStreetMap\",\"OpenStreetMap\",\"OpenStreetMap\",{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false,\"pane\":\"tilePane\"}]},{\"method\":\"addProviderTiles\",\"args\":[\"Esri.WorldImagery\",\"Esri.WorldImagery\",\"Esri.WorldImagery\",{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false,\"pane\":\"tilePane\"}]},{\"method\":\"addProviderTiles\",\"args\":[\"OpenTopoMap\",\"OpenTopoMap\",\"OpenTopoMap\",{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false,\"pane\":\"tilePane\"}]},{\"method\":\"createMapPane\",\"args\":[\"polygon\",420]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[-7.0479,-7.0457,-7.047,-7.0454,-7.05,-7.0442,-7.0347,-7.034,-7.0451,-7.0456,-7.0484,-7.0546,-7.057,-7.0558,-7.0626,-7.07,-7.0661,-7.0698,-7.0732,-7.0736,-7.0706,-7.0717,-7.0752,-7.0861,-7.0932,-7.0995,-7.1057,-7.1082,-7.1152,-7.1196,-7.1277,-7.1331,-7.1441,-7.1558,-7.175,-7.1816,-7.1986,-7.2129,-7.2226,-7.2311,-7.2338,-7.2382,-7.2547,-7.2547,-7.2594,-7.2707,-7.2867,-7.2889,-7.2948,-7.2971,-7.2899,-7.2911,-7.2945,-7.2861,-7.2734,-7.2758,-7.2736,-7.2683,-7.2641,-7.2634,-7.2647,-7.2741,-7.2802,-7.2827,-7.2855,-7.2804,-7.2782,-7.2756,-7.263,-7.2566,-7.2397,-7.2308,-7.2303,-7.2262,-7.2163,-7.1884,-7.1832,-7.1816,-7.1876,-7.1895,-7.1831,-7.1792,-7.1782,-7.1711,-7.1599,-7.153,-7.1415,-7.1356,-7.1289,-7.1285,-7.1226,-7.1221,-7.1232,-7.1267,-7.1313,-7.1316,-7.128,-7.1294,-7.1232,-7.124,-7.1143,-7.106,-7.1037,-7.096,-7.0882,-7.0821,-7.0805,-7.085,-7.0846,-7.0813,-7.0778,-7.0753,-7.0644,-7.0479],\"lat\":[42.626,42.6222,42.6123,42.6042,42.5979,42.5895,42.5873,42.5841,42.577,42.5743,42.5725,42.5716,42.5643,42.5597,42.5527,42.5594,42.5754,42.5803,42.582,42.5839,42.5865,42.5899,42.5894,42.5932,42.605,42.6057,42.6037,42.6013,42.6016,42.595,42.5949,42.5923,42.5785,42.5795,42.5752,42.563,42.5591,42.5455,42.5406,42.5398,42.5322,42.5301,42.5304,42.529,42.5267,42.5242,42.5299,42.5326,42.5325,42.535,42.5377,42.5429,42.547,42.5497,42.5592,42.5654,42.5647,42.5679,42.5738,42.578,42.5833,42.5943,42.5973,42.6062,42.6081,42.6072,42.6107,42.6102,42.6034,42.6063,42.6369,42.647,42.6515,42.6578,42.6683,42.6778,42.6826,42.6858,42.6872,42.6904,42.6994,42.7008,42.7049,42.7085,42.6973,42.6992,42.6992,42.6938,42.6906,42.6853,42.6817,42.6794,42.6745,42.671,42.6719,42.6694,42.6668,42.664,42.6581,42.6558,42.6536,42.6583,42.6575,42.65,42.6494,42.6468,42.6447,42.639,42.6368,42.6321,42.6328,42.6277,42.6285,42.626]}]]],null,\"aoi\",{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}},\"pane\":\"polygon\",\"stroke\":true,\"color\":\"#FF0000\",\"weight\":3,\"opacity\":0.9,\"fill\":true,\"fillColor\":\"#6666FF\",\"fillOpacity\":0,\"smoothFactor\":1,\"noClip\":false},\"<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\\/td><th><b>Feature ID&emsp;<\\/b><\\/th><td>1&emsp;<\\/td><\\/tr><tr><td>1<\\/td><th>GID_4&emsp;<\\/th><td>ESP.12.2.1.5_1&emsp;<\\/td><\\/tr><tr><td>2<\\/td><th>GID_0&emsp;<\\/th><td>ESP&emsp;<\\/td><\\/tr><tr><td>3<\\/td><th>COUNTRY&emsp;<\\/th><td>Spain&emsp;<\\/td><\\/tr><tr><td>4<\\/td><th>GID_1&emsp;<\\/th><td>ESP.12_1&emsp;<\\/td><\\/tr><tr><td>5<\\/td><th>NAME_1&emsp;<\\/th><td>Galicia&emsp;<\\/td><\\/tr><tr><td>6<\\/td><th>GID_2&emsp;<\\/th><td>ESP.12.2_1&emsp;<\\/td><\\/tr><tr><td>7<\\/td><th>NAME_2&emsp;<\\/th><td>Lugo&emsp;<\\/td><\\/tr><tr><td>8<\\/td><th>GID_3&emsp;<\\/th><td>ESP.12.2.1_1&emsp;<\\/td><\\/tr><tr><td>9<\\/td><th>NAME_3&emsp;<\\/th><td>n.a. (169)&emsp;<\\/td><\\/tr><tr><td>10<\\/td><th>NAME_4&emsp;<\\/th><td>Folgoso do Courel&emsp;<\\/td><\\/tr><tr><td>11<\\/td><th>VARNAME_4&emsp;<\\/th><td>Folgoso de Caurel&emsp;<\\/td><\\/tr><tr><td>12<\\/td><th>TYPE_4&emsp;<\\/th><td>Municipality&emsp;<\\/td><\\/tr><tr><td>13<\\/td><th>ENGTYPE_4&emsp;<\\/th><td>Municipality&emsp;<\\/td><\\/tr><tr><td>14<\\/td><th>CC_4&emsp;<\\/th><td>NA&emsp;<\\/td><\\/tr><tr><td>15<\\/td><th>geometry&emsp;<\\/th><td>sfc_POLYGON&emsp;<\\/td><\\/tr><\\/table><\\/div>\",{\"maxWidth\":800,\"minWidth\":50,\"autoPan\":true,\"keepInView\":false,\"closeButton\":true,\"closeOnClick\":true,\"className\":\"\"},\"Folgoso do Courel\",{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},{\"stroke\":true,\"weight\":5,\"opacity\":0.9,\"fillOpacity\":0,\"bringToFront\":false,\"sendToBack\":false}]},{\"method\":\"addScaleBar\",\"args\":[{\"maxWidth\":100,\"metric\":true,\"imperial\":true,\"updateWhenIdle\":true,\"position\":\"bottomleft\"}]},{\"method\":\"addHomeButton\",\"args\":[-7.2971,42.5242,-7.034,42.7085,true,\"aoi\",\"Zoom to aoi\",\"<strong> aoi <\\/strong>\",\"bottomright\"]},{\"method\":\"addLayersControl\",\"args\":[[\"CartoDB.Positron\",\"CartoDB.DarkMatter\",\"OpenStreetMap\",\"Esri.WorldImagery\",\"OpenTopoMap\"],\"aoi\",{\"collapsed\":true,\"autoZIndex\":true,\"position\":\"topleft\"}]}],\"limits\":{\"lat\":[42.5242,42.7085],\"lng\":[-7.2971,-7.034]},\"fitBounds\":[42.5242,-7.2971,42.7085,-7.034,[]]},\"evals\":[],\"jsHooks\":{\"render\":[{\"code\":\"function(el, x, data) {\\n  return (\\n      function(el, x, data) {\\n      // get the leaflet map\\n      var map = this; //HTMLWidgets.find('#' + el.id);\\n      // we need a new div element because we have to handle\\n      // the mouseover output separately\\n      // debugger;\\n      function addElement () {\\n      // generate new div Element\\n      var newDiv = $(document.createElement('div'));\\n      // append at end of leaflet htmlwidget container\\n      $(el).append(newDiv);\\n      //provide ID and style\\n      newDiv.addClass('lnlt');\\n      newDiv.css({\\n      'position': 'relative',\\n      'bottomleft':  '0px',\\n      'background-color': 'rgba(255, 255, 255, 0.7)',\\n      'box-shadow': '0 0 2px #bbb',\\n      'background-clip': 'padding-box',\\n      'margin': '0',\\n      'padding-left': '5px',\\n      'color': '#333',\\n      'font': '9px/1.5 \\\"Helvetica Neue\\\", Arial, Helvetica, sans-serif',\\n      'z-index': '700',\\n      });\\n      return newDiv;\\n      }\\n\\n\\n      // check for already existing lnlt class to not duplicate\\n      var lnlt = $(el).find('.lnlt');\\n\\n      if(!lnlt.length) {\\n      lnlt = addElement();\\n\\n      // grab the special div we generated in the beginning\\n      // and put the mousmove output there\\n\\n      map.on('mousemove', function (e) {\\n      if (e.originalEvent.ctrlKey) {\\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\\n      lnlt.text(\\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\\n                           ' | zoom: ' + map.getZoom() +\\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\\n                           ' | epsg: 3857 ' +\\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\\n      } else {\\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\\n      lnlt.text(\\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\\n                      ' | zoom: ' + map.getZoom() + ' ');\\n      }\\n      });\\n\\n      // remove the lnlt div when mouse leaves map\\n      map.on('mouseout', function (e) {\\n      var strip = document.querySelector('.lnlt');\\n      if( strip !==null) strip.remove();\\n      });\\n\\n      };\\n\\n      //$(el).keypress(67, function(e) {\\n      map.on('preclick', function(e) {\\n      if (e.originalEvent.ctrlKey) {\\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\\n      lnlt.text(\\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\\n                      ' | zoom: ' + map.getZoom() + ' ');\\n      var txt = document.querySelector('.lnlt').textContent;\\n      console.log(txt);\\n      //txt.innerText.focus();\\n      //txt.select();\\n      setClipboardText('\\\"' + txt + '\\\"');\\n      }\\n      });\\n\\n      }\\n      ).call(this.getMap(), el, x, data);\\n}\",\"data\":null},{\"code\":\"function(el, x, data) {\\n  return (function(el,x,data){\\n           var map = this;\\n\\n           map.on('keypress', function(e) {\\n               console.log(e.originalEvent.code);\\n               var key = e.originalEvent.code;\\n               if (key === 'KeyE') {\\n                   var bb = this.getBounds();\\n                   var txt = JSON.stringify(bb);\\n                   console.log(txt);\\n\\n                   setClipboardText('\\\\'' + txt + '\\\\'');\\n               }\\n           })\\n        }).call(this.getMap(), el, x, data);\\n}\",\"data\":null}]}}</script>\n```\n\n\nLocation of the study area (Folgoso do Courel, Galicia)\n:::\n:::\n\n\n<br>\n\nWe can illustrate this by plotting the slope of the study area. To do so, we can download the DEM with the next chnuk of code, and compute the slope with the `terra::terrain()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download the DEM\ndem <- get_elev_raster(\n  locations = aoi,\n  z = 14,\n  clip = \"bbox\"\n  ) |>\n    rast()\n\n# Compute the slope\nslope <- terrain(dem, v = 'slope')\n```\n:::\n\n\nNext, a graphical representation of the DEM and the slope is presented in @fig-dem and @fig-slope, respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npal <- brewer.pal(n = 10, name = 'RdYlBu')\nplot(dem, col = pal, main = 'DEM')\nplot(slope, col = pal, main = 'Slope')\n```\n:::\n\n\n::: panel-tabset\n## DEM\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Representation of the DEM in the bounding box the study area (Folgoso do Courel, Galicia, Spain)](index_files/figure-html/fig-dem-1.png){#fig-dem width=672}\n:::\n:::\n\n\n## Slope\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Representation of the slope in the bounding box the study area (Folgoso do Courel, Galicia, Spain).](index_files/figure-html/fig-slope-1.png){#fig-slope width=672}\n:::\n:::\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\r\n<script src=\"site_libs/jquery-1.12.4/jquery.min.js\"></script>\r\n<link href=\"site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/leaflet-1.3.1/leaflet.js\"></script>\r\n<link href=\"site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/proj4-2.6.2/proj4.min.js\"></script>\r\n<script src=\"site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\r\n<link href=\"site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/leaflet-binding-2.1.2/leaflet.js\"></script>\r\n<script src=\"site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js\"></script>\r\n<script src=\"site_libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js\"></script>\r\n<link href=\"site_libs/HomeButton-0.0.1/home-button.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/HomeButton-0.0.1/home-button.js\"></script>\r\n<script src=\"site_libs/HomeButton-0.0.1/easy-button-src.min.js\"></script>\r\n<script src=\"site_libs/clipboard-0.0.1/setClipboardText.js\"></script>\r\n<link href=\"site_libs/mapviewCSS-0.0.1/mapview-popup.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/mapviewCSS-0.0.1/mapview.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}